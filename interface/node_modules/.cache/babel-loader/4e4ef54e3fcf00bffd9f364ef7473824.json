{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Util_1 = require(\"./Util\");\n\nvar Container_1 = require(\"./Container\");\n\nvar Factory_1 = require(\"./Factory\");\n\nvar BaseLayer_1 = require(\"./BaseLayer\");\n\nvar Canvas_1 = require(\"./Canvas\");\n\nvar Shape_1 = require(\"./Shape\");\n\nvar Validators_1 = require(\"./Validators\");\n\nvar Global_1 = require(\"./Global\");\n\nvar HASH = '#',\n    BEFORE_DRAW = 'beforeDraw',\n    DRAW = 'draw',\n    INTERSECTION_OFFSETS = [{\n  x: 0,\n  y: 0\n}, {\n  x: -1,\n  y: -1\n}, {\n  x: 1,\n  y: -1\n}, {\n  x: 1,\n  y: 1\n}, {\n  x: -1,\n  y: 1\n}],\n    INTERSECTION_OFFSETS_LEN = INTERSECTION_OFFSETS.length;\n\nvar Layer = function (_super) {\n  __extends(Layer, _super);\n\n  function Layer() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.hitCanvas = new Canvas_1.HitCanvas({\n      pixelRatio: 1\n    });\n    return _this;\n  }\n\n  Layer.prototype.setSize = function (_a) {\n    var width = _a.width,\n        height = _a.height;\n\n    _super.prototype.setSize.call(this, {\n      width: width,\n      height: height\n    });\n\n    this.hitCanvas.setSize(width, height);\n    return this;\n  };\n\n  Layer.prototype._validateAdd = function (child) {\n    var type = child.getType();\n\n    if (type !== 'Group' && type !== 'Shape') {\n      Util_1.Util.throw('You may only add groups and shapes to a layer.');\n    }\n  };\n\n  Layer.prototype.getIntersection = function (pos, selector) {\n    var obj, i, intersectionOffset, shape;\n\n    if (!this.hitGraphEnabled() || !this.isVisible()) {\n      return null;\n    }\n\n    var spiralSearchDistance = 1;\n    var continueSearch = false;\n\n    while (true) {\n      for (i = 0; i < INTERSECTION_OFFSETS_LEN; i++) {\n        intersectionOffset = INTERSECTION_OFFSETS[i];\n        obj = this._getIntersection({\n          x: pos.x + intersectionOffset.x * spiralSearchDistance,\n          y: pos.y + intersectionOffset.y * spiralSearchDistance\n        });\n        shape = obj.shape;\n\n        if (shape && selector) {\n          return shape.findAncestor(selector, true);\n        } else if (shape) {\n          return shape;\n        }\n\n        continueSearch = !!obj.antialiased;\n\n        if (!obj.antialiased) {\n          break;\n        }\n      }\n\n      if (continueSearch) {\n        spiralSearchDistance += 1;\n      } else {\n        return null;\n      }\n    }\n  };\n\n  Layer.prototype._getIntersection = function (pos) {\n    var ratio = this.hitCanvas.pixelRatio;\n    var p = this.hitCanvas.context.getImageData(Math.round(pos.x * ratio), Math.round(pos.y * ratio), 1, 1).data,\n        p3 = p[3],\n        colorKey,\n        shape;\n\n    if (p3 === 255) {\n      colorKey = Util_1.Util._rgbToHex(p[0], p[1], p[2]);\n      shape = Shape_1.shapes[HASH + colorKey];\n\n      if (shape) {\n        return {\n          shape: shape\n        };\n      }\n\n      return {\n        antialiased: true\n      };\n    } else if (p3 > 0) {\n      return {\n        antialiased: true\n      };\n    }\n\n    return {};\n  };\n\n  Layer.prototype.drawScene = function (can, top) {\n    var layer = this.getLayer(),\n        canvas = can || layer && layer.getCanvas();\n\n    this._fire(BEFORE_DRAW, {\n      node: this\n    });\n\n    if (this.clearBeforeDraw()) {\n      canvas.getContext().clear();\n    }\n\n    Container_1.Container.prototype.drawScene.call(this, canvas, top);\n\n    this._fire(DRAW, {\n      node: this\n    });\n\n    return this;\n  };\n\n  Layer.prototype.drawHit = function (can, top) {\n    var layer = this.getLayer(),\n        canvas = can || layer && layer.hitCanvas;\n\n    if (layer && layer.clearBeforeDraw()) {\n      layer.getHitCanvas().getContext().clear();\n    }\n\n    Container_1.Container.prototype.drawHit.call(this, canvas, top);\n    return this;\n  };\n\n  Layer.prototype.clear = function (bounds) {\n    BaseLayer_1.BaseLayer.prototype.clear.call(this, bounds);\n    this.getHitCanvas().getContext().clear(bounds);\n    return this;\n  };\n\n  Layer.prototype.enableHitGraph = function () {\n    this.hitGraphEnabled(true);\n    return this;\n  };\n\n  Layer.prototype.disableHitGraph = function () {\n    this.hitGraphEnabled(false);\n    return this;\n  };\n\n  Layer.prototype.toggleHitCanvas = function () {\n    if (!this.parent) {\n      return;\n    }\n\n    var parent = this.parent;\n    var added = !!this.hitCanvas._canvas.parentNode;\n\n    if (added) {\n      parent.content.removeChild(this.hitCanvas._canvas);\n    } else {\n      parent.content.appendChild(this.hitCanvas._canvas);\n    }\n  };\n\n  return Layer;\n}(BaseLayer_1.BaseLayer);\n\nexports.Layer = Layer;\nLayer.prototype.nodeType = 'Layer';\n\nGlobal_1._registerNode(Layer);\n\nFactory_1.Factory.addGetterSetter(Layer, 'hitGraphEnabled', true, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Layer);","map":{"version":3,"sources":["/mnt/c/Users/anjul/OneDrive - Stony Brook University/Documents/infographics_generation/interface/node_modules/konva/lib/Layer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","exports","value","Util_1","require","Container_1","Factory_1","BaseLayer_1","Canvas_1","Shape_1","Validators_1","Global_1","HASH","BEFORE_DRAW","DRAW","INTERSECTION_OFFSETS","x","y","INTERSECTION_OFFSETS_LEN","length","Layer","_super","_this","apply","arguments","hitCanvas","HitCanvas","pixelRatio","setSize","_a","width","height","call","_validateAdd","child","type","getType","Util","throw","getIntersection","pos","selector","obj","i","intersectionOffset","shape","hitGraphEnabled","isVisible","spiralSearchDistance","continueSearch","_getIntersection","findAncestor","antialiased","ratio","context","getImageData","Math","round","data","p3","colorKey","_rgbToHex","shapes","drawScene","can","top","layer","getLayer","canvas","getCanvas","_fire","node","clearBeforeDraw","getContext","clear","Container","drawHit","getHitCanvas","bounds","BaseLayer","enableHitGraph","disableHitGraph","toggleHitCanvas","parent","added","_canvas","parentNode","content","removeChild","appendChild","nodeType","_registerNode","Factory","addGetterSetter","getBooleanValidator","Collection","mapMethods"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Container_1 = require(\"./Container\");\nvar Factory_1 = require(\"./Factory\");\nvar BaseLayer_1 = require(\"./BaseLayer\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Shape_1 = require(\"./Shape\");\nvar Validators_1 = require(\"./Validators\");\nvar Global_1 = require(\"./Global\");\nvar HASH = '#', BEFORE_DRAW = 'beforeDraw', DRAW = 'draw', INTERSECTION_OFFSETS = [\n    { x: 0, y: 0 },\n    { x: -1, y: -1 },\n    { x: 1, y: -1 },\n    { x: 1, y: 1 },\n    { x: -1, y: 1 }\n], INTERSECTION_OFFSETS_LEN = INTERSECTION_OFFSETS.length;\nvar Layer = (function (_super) {\n    __extends(Layer, _super);\n    function Layer() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.hitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1\n        });\n        return _this;\n    }\n    Layer.prototype.setSize = function (_a) {\n        var width = _a.width, height = _a.height;\n        _super.prototype.setSize.call(this, { width: width, height: height });\n        this.hitCanvas.setSize(width, height);\n        return this;\n    };\n    Layer.prototype._validateAdd = function (child) {\n        var type = child.getType();\n        if (type !== 'Group' && type !== 'Shape') {\n            Util_1.Util.throw('You may only add groups and shapes to a layer.');\n        }\n    };\n    Layer.prototype.getIntersection = function (pos, selector) {\n        var obj, i, intersectionOffset, shape;\n        if (!this.hitGraphEnabled() || !this.isVisible()) {\n            return null;\n        }\n        var spiralSearchDistance = 1;\n        var continueSearch = false;\n        while (true) {\n            for (i = 0; i < INTERSECTION_OFFSETS_LEN; i++) {\n                intersectionOffset = INTERSECTION_OFFSETS[i];\n                obj = this._getIntersection({\n                    x: pos.x + intersectionOffset.x * spiralSearchDistance,\n                    y: pos.y + intersectionOffset.y * spiralSearchDistance\n                });\n                shape = obj.shape;\n                if (shape && selector) {\n                    return shape.findAncestor(selector, true);\n                }\n                else if (shape) {\n                    return shape;\n                }\n                continueSearch = !!obj.antialiased;\n                if (!obj.antialiased) {\n                    break;\n                }\n            }\n            if (continueSearch) {\n                spiralSearchDistance += 1;\n            }\n            else {\n                return null;\n            }\n        }\n    };\n    Layer.prototype._getIntersection = function (pos) {\n        var ratio = this.hitCanvas.pixelRatio;\n        var p = this.hitCanvas.context.getImageData(Math.round(pos.x * ratio), Math.round(pos.y * ratio), 1, 1).data, p3 = p[3], colorKey, shape;\n        if (p3 === 255) {\n            colorKey = Util_1.Util._rgbToHex(p[0], p[1], p[2]);\n            shape = Shape_1.shapes[HASH + colorKey];\n            if (shape) {\n                return {\n                    shape: shape\n                };\n            }\n            return {\n                antialiased: true\n            };\n        }\n        else if (p3 > 0) {\n            return {\n                antialiased: true\n            };\n        }\n        return {};\n    };\n    Layer.prototype.drawScene = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.getCanvas());\n        this._fire(BEFORE_DRAW, {\n            node: this\n        });\n        if (this.clearBeforeDraw()) {\n            canvas.getContext().clear();\n        }\n        Container_1.Container.prototype.drawScene.call(this, canvas, top);\n        this._fire(DRAW, {\n            node: this\n        });\n        return this;\n    };\n    Layer.prototype.drawHit = function (can, top) {\n        var layer = this.getLayer(), canvas = can || (layer && layer.hitCanvas);\n        if (layer && layer.clearBeforeDraw()) {\n            layer\n                .getHitCanvas()\n                .getContext()\n                .clear();\n        }\n        Container_1.Container.prototype.drawHit.call(this, canvas, top);\n        return this;\n    };\n    Layer.prototype.clear = function (bounds) {\n        BaseLayer_1.BaseLayer.prototype.clear.call(this, bounds);\n        this.getHitCanvas()\n            .getContext()\n            .clear(bounds);\n        return this;\n    };\n    Layer.prototype.enableHitGraph = function () {\n        this.hitGraphEnabled(true);\n        return this;\n    };\n    Layer.prototype.disableHitGraph = function () {\n        this.hitGraphEnabled(false);\n        return this;\n    };\n    Layer.prototype.toggleHitCanvas = function () {\n        if (!this.parent) {\n            return;\n        }\n        var parent = this.parent;\n        var added = !!this.hitCanvas._canvas.parentNode;\n        if (added) {\n            parent.content.removeChild(this.hitCanvas._canvas);\n        }\n        else {\n            parent.content.appendChild(this.hitCanvas._canvas);\n        }\n    };\n    return Layer;\n}(BaseLayer_1.BaseLayer));\nexports.Layer = Layer;\nLayer.prototype.nodeType = 'Layer';\nGlobal_1._registerNode(Layer);\nFactory_1.Factory.addGetterSetter(Layer, 'hitGraphEnabled', true, Validators_1.getBooleanValidator());\nUtil_1.Collection.mapMethods(Layer);\n"]},"metadata":{},"sourceType":"script"}